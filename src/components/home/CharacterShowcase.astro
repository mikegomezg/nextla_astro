---
import Section from "../shared/Section.astro";
import FeatherMotif from "../shared/FeatherMotif.astro";
import { characters } from "../../data/characters.js";

// Character image paths
const characterImages = {
  "Silas Hale": "/assets/characters/silas.png",
  "Nova": "/assets/characters/nova.png",
  "Victoria Ford": "/assets/characters/victoria.png",
  "Enrique Lara": "/assets/characters/enrique.png",
  "John Lawson": "/assets/characters/john.png"
};
---

<Section 
  title="Meet the Characters" 
  id="characters"
  bgColor="neutral-800"
  classes="relative overflow-hidden"
>
  <!-- Background patterns -->
  <div class="absolute inset-0 z-0 opacity-5">
    <div class="absolute top-0 right-0">
      <FeatherMotif width="400" height="400" color="white" rotate="180" />
    </div>
    <div class="absolute bottom-0 left-0">
      <FeatherMotif width="300" height="300" color="white" rotate="0" />
    </div>
  </div>

  <!-- Character scroll container -->
  <div class="character-scroll-container overflow-x-auto pb-8 relative z-10">
    <div class="character-grid flex space-x-6 min-w-max px-4">
      {characters.map((character) => (
        <div class={`character-card bg-neutral-900 rounded-lg p-6 border-l-4 border-${character.color} transition-all hover:shadow-${character.color}/30 hover:shadow-lg w-72 flex flex-col`}>
          <!-- Character image with circular border -->
          <div class="relative mb-4 aspect-square overflow-hidden flex items-center justify-center">
            <div class={`rounded-full w-48 h-48 overflow-hidden border-4 border-${character.color} mx-auto`}>
              <img 
                src={characterImages[character.characterName] || "#"} 
                alt={character.characterName}
                class="object-cover w-full h-full"
                onerror={`this.style.display='none'; this.parentElement.innerHTML += '<div class="absolute inset-0 flex items-center justify-center bg-neutral-800"><span class="text-${character.color} text-4xl font-bold">${character.characterName.charAt(0)}</span></div>'`}
              />
            </div>
            
            <!-- Feather overlay -->
            <div class="absolute top-0 right-0 p-2">
              <FeatherMotif 
                width="40" 
                height="40" 
                color={character.color} 
                opacity="0.6" 
                rotate="15"
              />
            </div>
          </div>

          <h3 class={`text-xl font-bold text-white mb-1`}>{character.characterName}</h3>
          <p class={`text-sm text-${character.accentColor} mb-3`}>{character.role}</p>
          <p class="text-neutral-300 mb-4 flex-grow">{character.description}</p>

          <a
            href={`/characters/${character.characterName.toLowerCase().replace(/\s+/g, "-")}`}
            class={`inline-block px-4 py-2 bg-${character.color}/20 text-${character.accentColor} border border-${character.color}/40 rounded hover:bg-${character.color}/30 transition-colors mt-auto`}
          >
            Explore {character.characterName}'s Story
          </a>
        </div>
      ))}
    </div>
  </div>
  
  <!-- Scroll indicators -->
  <div class="flex justify-between items-center mt-4 px-4">
    <button id="scroll-left" class="p-2 bg-neutral-800/50 rounded-full text-white hover:bg-neutral-700/50 transition-colors">
      <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7" />
      </svg>
    </button>
    
    <div class="scroll-indicator-dots flex space-x-2">
      <!-- Dots will be generated by JS -->
    </div>
    
    <button id="scroll-right" class="p-2 bg-neutral-800/50 rounded-full text-white hover:bg-neutral-700/50 transition-colors">
      <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7" />
      </svg>
    </button>
  </div>
</Section>

<script>
  document.addEventListener('DOMContentLoaded', () => {
    const scrollContainer = document.querySelector('.character-scroll-container');
    const scrollLeftBtn = document.getElementById('scroll-left');
    const scrollRightBtn = document.getElementById('scroll-right');
    const characterCards = document.querySelectorAll('.character-card');
    const dotsContainer = document.querySelector('.scroll-indicator-dots');
    
    if (!scrollContainer || !scrollLeftBtn || !scrollRightBtn || !dotsContainer) return;
    
    // Create indicator dots
    const totalSlides = Math.ceil(characterCards.length - (window.innerWidth / 350));
    for (let i = 0; i < totalSlides + 1; i++) {
      const dot = document.createElement('div');
      dot.classList.add('w-2', 'h-2', 'rounded-full', 'bg-neutral-600');
      if (i === 0) dot.classList.add('bg-jade');
      dotsContainer.appendChild(dot);
    }
    
    const dots = dotsContainer.querySelectorAll('div');
    
    // Scroll functionality
    scrollLeftBtn.addEventListener('click', () => {
      scrollContainer.scrollBy({ left: -300, behavior: 'smooth' });
    });
    
    scrollRightBtn.addEventListener('click', () => {
      scrollContainer.scrollBy({ left: 300, behavior: 'smooth' });
    });
    
    // Update dots on scroll
    scrollContainer.addEventListener('scroll', () => {
      const scrollPercentage = scrollContainer.scrollLeft / (scrollContainer.scrollWidth - scrollContainer.clientWidth);
      const activeDotIndex = Math.min(
        Math.floor(scrollPercentage * (dots.length)),
        dots.length - 1
      );
      
      dots.forEach((dot, index) => {
        dot.classList.toggle('bg-jade', index === activeDotIndex);
        dot.classList.toggle('bg-neutral-600', index !== activeDotIndex);
      });
    });
  });
</script>

<style>
  /* Hide scrollbar but allow scrolling */
  .character-scroll-container {
    -ms-overflow-style: none;  /* IE and Edge */
    scrollbar-width: none;  /* Firefox */
  }
  
  .character-scroll-container::-webkit-scrollbar {
    display: none;  /* Chrome, Safari, Opera */
  }
</style>
